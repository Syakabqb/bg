"use strict";var schedules,firstContact,rawFile=new XMLHttpRequest;rawFile.open("GET","duruduru.txt",!1),rawFile.setRequestHeader("Content-Type","text/html;charset=utf-8"),rawFile.onreadystatechange=function(){if(4===rawFile.readyState&&(200===rawFile.status||0==rawFile.status)){var e=rawFile.responseText;console.log(e),schedules=e.split("|||")[0],firstContact=e.split("|||")[1]}},rawFile.send(null);var DATE=0,PUBLIC=1,PARTICIPANTS=2,dataSchedules=[],dataCoOccuranceList={},dataFirstContact={},dataBonus={},dataScores=[];for(var key in schedules.split("|").forEach(function(e){if(0!=e.length){var a=e.split("\t"),t=[];t[DATE]=a[0],"Y"==a[1]?t[PUBLIC]=!0:t[PUBLIC]=!1,t[PARTICIPANTS]=[];for(var n=2;n<a.length;n++)a[n].length>0&&t[PARTICIPANTS].push(a[n]);dataSchedules.push(t)}}),dataSchedules.forEach(function(e){for(var a=0;a<e[PARTICIPANTS].length-1;a++){var t=e[PARTICIPANTS][a].trim();null==dataCoOccuranceList[t]&&(dataCoOccuranceList[t]=new Set,dataFirstContact[t]=new Set,dataBonus[t]=0);for(var n=a+1;n<e[PARTICIPANTS].length;n++){var r=e[PARTICIPANTS][n].trim();null==dataCoOccuranceList[r]&&(dataCoOccuranceList[r]=new Set,dataFirstContact[r]=new Set,dataBonus[r]=0),dataCoOccuranceList[t].add(r),dataCoOccuranceList[r].add(t)}}if(1==e[PUBLIC]){dataBonus[e[PARTICIPANTS][0].trim()]+=2;for(var c=1;c<e[PARTICIPANTS].length;c++)dataBonus[e[PARTICIPANTS][c].trim()]+=1}}),firstContact.split("|").forEach(function(e){if(0!=e.length){var a=e.split("\t");if(!(a.length<2)){var t=a[0].trim(),n=a[1].trim();null!=dataFirstContact[t]&&null!=dataFirstContact[n]&&(dataFirstContact[t].add(n),dataFirstContact[n].add(t))}}}),dataBonus)dataScores.push({score:dataBonus[key]+dataCoOccuranceList[key].size+dataFirstContact[key].size,name:key});dataScores.sort(function(e,a){return e.score>a.score?-1:e.score<a.score?1:e.name>a.name?1:e.name<a.name?-1:0}),console.log("dataSchedules",dataSchedules),console.log("dataCoOccuranceList",dataCoOccuranceList),console.log("dataBonus",dataBonus),console.log("dataScores",dataScores);var tlbTopBoard=document.getElementById("tlbTopBoard"),rankingIdx=1,prevRankingIdx=0,prevScore=0;dataScores.forEach(function(e){var a=document.createElement("tr");tlbTopBoard.appendChild(a);var t=document.createElement("td");a.appendChild(t),prevScore!=e.score?t.innerHTML=rankingIdx:t.innerHTML=prevRankingIdx,prevRankingIdx=t.innerHTML,rankingIdx+=1,prevScore=e.score;var n=document.createElement("td");a.appendChild(n),n.innerHTML=e.name;var r=document.createElement("td");a.appendChild(r);var c=e.score+" = "+dataCoOccuranceList[e.name].size+" (함께한 사람수)";e.score-dataCoOccuranceList[e.name].size>0&&(c=c+" + "+(e.score-dataCoOccuranceList[e.name].size)+" (가산점)"),r.innerHTML=c;var d=document.createElement("td");a.appendChild(d);var o="";dataCoOccuranceList[e.name].forEach(function(a){o+="<span",1==dataFirstContact[e.name].has(a)&&(o+=" class='colorRed'"),o+=">",o+=a,o+="</span> "}),d.innerHTML=o});var tblSchdules=document.getElementById("tblSchdules");dataSchedules.forEach(function(e){var a=document.createElement("tr");tblSchdules.appendChild(a);var t=document.createElement("td");a.appendChild(t),t.innerHTML=e[DATE];var n=document.createElement("td");a.appendChild(n),1==e[PUBLIC]?n.innerHTML="Y":n.innerHTML="N";var r=document.createElement("td");a.appendChild(r),r.innerHTML=e[PARTICIPANTS][0];var c=document.createElement("td");a.appendChild(c);for(var d="",o=1;o<e[PARTICIPANTS].length;o++)d+=e[PARTICIPANTS][o]+" ";c.innerHTML=d});
